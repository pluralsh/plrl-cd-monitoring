apiVersion: deployments.plural.sh/v1alpha1
kind: ServiceDeployment
metadata:
  name: loki
  namespace: {{ configuration.namespace }}
spec:
  namespace: monitoring
  git:
    folder: helm-values
    ref: logstack
  configurationRef:
    name: basic-auth
    namespace: {{ configuration.namespace }}
  repositoryRef:
    kind: GitRepository
    name: monitoring
    namespace: {{ configuration.namespace }}
  contexts:
    - loki # binds the loki context from the tf stack to this service
  helm:
    version: 5.43.6
    chart: loki
    valuesFiles:
    - loki.yaml
    - loki.yaml.liquid
    repository:
      name: grafana
      namespace: {{ configuration.namespace }}
  clusterRef:
    kind: Cluster
    name: mgmt
    namespace: infra
